<!doctype html>
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<%# if we got any meta tag info from request display it, otherwise just render head normally %>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# shelbytv: http://ogp.me/ns/fb/shelbytv#">
  <%= render :partial => "/home/meta_info" %>
  <meta charset="utf-8">
  <title>
    <%= render :partial => "/home/title_tag" %>
  </title>

  <meta name="csrf-token" content="<%= csrf_token_from_cookie %>">
  <meta name="rhombus-auth" content="<%= 'Basic '+Base64.strict_encode64('shelby:_rhombus_gt') %>">

  <meta content="user-scalable=no, width=device-width, initial-scale=1.0" name="viewport">
  <% if @include_smart_app_banner %>
    <meta name="apple-itunes-app" content="app-id=<%= Settings::Application.ios_app_id %>, app-argument=<%= Settings::Application.ios_url_scheme %>user/<%= @user['id'] %>">
  <% end %>

  <link rel="apple-touch-icon-precomposed" href="http://shelby.tv/apple-touch-icon-precomposed.png" />
  <link rel="apple-touch-icon" href="http://shelby.tv/apple-touch-icon-precomposed.png"/>
  <link rel="icon"type="image/png" href="/favicon.png">

  <script>
    var shelbyTrackingCategory = "Mobile",
        shelbyTrackingLabel<%= raw " = '#{@signed_in_user['nickname']}'" %>,
        appropriateSubdirectory = '<%= appropriate_subdirectory %>';
  </script>

  <%= stylesheet_link_tag "mobile", :media => "screen" %>

  <script>
    if (typeof(shelby) == 'undefined') {
      shelby = {};
    }
    if (typeof(shelby.abTests) == 'undefined') {
      shelby.abTests = {};
    }
    <% vanity_experiments.each do |name, alternative| %>
      shelby.abTests.<%= name.to_s.camelize(:lower) %> = '<%= alternative.value %>';
    <% end %>
  </script>
  <%= javascript_include_tag "mobile" %>

  <%= render :partial => '/objects/noscript' %>
</head>

<body class="shelby shelby--shares shelby--mobile<%= " shelby--user_signed_in" if @user_signed_in %>">
  <!-- Facebook widget -->
  <div id="fb-root"></div>

  <div id="js-shelby-wrapper" class="shelby-wrapper clearfix">
    <header id="js-header" class="animate_module js-app-header shelby-header clearfix js-inactivity-preemption" role="banner">
      <%= render :partial => '/home/app_header',
          :locals => {
            :show_login     => true,
            :signed_in_user => @signed_in_user,
            :is_mobile      => @is_mobile,
            :pathname       => @roll_type,
            :ga_category    => "Mobile",
            :user_signed_in => @user_signed_in
          } %>
    </header>

    <div class="content_wrapper clearfix js-guide" role="main">
      <div class="notification clearfix js-flash">
        <%= render :partial => "/mobile/partials/flash_messages", :locals => { :ga_category => "Mobile"} if !flash.empty? %>
      </div>

      <%= yield %>
    </div>

    <script id="js-user" type="application/json">
      <%= raw @signed_in_user.to_json %>
    </script>

    <script id="js-frame-like" type="application/json">
      <div class="frame-likes frame-external-subline icon-like icon-like--red js-frame-likes">
        <ul class="list frame-likes-avatars js-liker-avatars-list"></ul>
        <span class="frame-likes-count frame-external-subline-text invisible js-like-total">+ 0</span>
      </div>
    </script>

    <% if @user_signed_in %>
      <script id="js-user-like" type="application/json">
        <li>
          <a class="image_module avatar avatar--tiny frame-likes-link js-track-event" style="background-image: url(<%= avatar_url_for_user(@signed_in_user) %>)" href="/<%= @signed_in_user['id'] %>" data-ga_category="Share Page" data-ga_action="click avatar for liker" data-ga_label="">
            <img class="visuallyhidden" src="<%= avatar_url_for_user(@signed_in_user) %>" title="<%= @signed_in_user['nickname'] %>" alt="<%= @signed_in_user['nickname'] %>" />
          </a>
        </li>
      </script>
    <% end %>

    <div class="share_panel share_panel--fill share_panel--scroll hidden js-share-panel">
      <!-- filled in by underscore goodness -->
    </div>

    <div class="notification js-notification hidden">
      <p><strong>Share successful!</strong></p>
    </div>

  </div> <!-- eo ~application -->
  <% if ["production", "staging"].include? Rails.env %>
    <script>
      var _gaq=[['_setAccount','<%= Settings::GoogleAnalytics.code %>'],['_setDomainName','shelby.tv'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
  <% end %>

  <% if Rails.env == 'production' %>
    <script>
      var _kmq = _kmq || [];
      var _kmk = _kmk || '9b8c2d291a85a66412fc8c0085125194646fd7a6';
      function _kms(u){
        setTimeout(function(){
          var d = document, f = d.getElementsByTagName('script')[0],
          s = d.createElement('script');
          s.type = 'text/javascript'; s.async = true; s.src = u;
          f.parentNode.insertBefore(s, f);
        }, 1);
      }
      _kms('//i.kissmetrics.com/i.js');
      _kms('//doug1izaerwt3.cloudfront.net/' + _kmk + '.1.js');
    </script>
  <% end %>
  <% if ["production", "staging"].include? Rails.env %>
    <script>(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://api.intercom.io/api/js/library.js';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}};})()</script>
<% end %>
  <%= vanity_js %>
  <% experiments = vanity_experiments %>
  <% unless experiments.empty? %>
    <script>
      <% experiments.each do |name, alternative| %>
        try {
          _gaq.push(['_trackEvent', 'ab-testing', '<%= name %>', '<%= alternative.value %>']);
        } catch(e) {}
      <% end %>
    </script>
  <% end %>

  <script>
  (function(d){
     var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/en_US/all.js";
     d.getElementsByTagName('head')[0].appendChild(js);
   }(document));
  </script>

</body>
</html>
