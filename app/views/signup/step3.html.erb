<div class="signup signup--profile<%= ' signup--profile_no-avatar' unless @user.has_key?('authentications') %>" role="main">
  <div class="signup__head">
    <h2 class="signup__h3">
      Step 3 of 3
    </h2>

    <h1 class="signup__h1">
      Make Shelby TV yours
    </h1>
  </div>

  <div class="signup__body">
    <%= form_tag(request.env['PATH_INFO'], { :id => 'user_form', :class => 'form_module' }) do %>
      <fieldset class="form_fieldset">
        <legend class="form__legend">
          Watch your personalized video stream from anywhere<br/>
          and curate your own Shelby TV channel.
        </legend>

        <div class="media_module">
          <% if @user.has_key?('authentications') %>
            <div class="media_image avatar__wrapper js-avatar-renderer">
              <div class="dynamic-avatar">
                <div class="image_module avatar avatar--largest js-avatar-image" style="background-image: url('<%= avatar_url_for_user(@user, "sq192x192") %>')">
                </div>
                <div class="progress-overlay"></div>
              </div>
              <input id="fileupload" type="file" name="avatar" accept="image/*">
            </div><!-- eo media_image -->
          <% end %>

          <div class="media_body">
            <fieldset class="form_fieldset">
              <%= label_tag 'name', 'Full Name', :class => 'form_label' %>
              <span class="form_error js-form-error">Please enter your name</span>
              <%= text_field_tag 'name', @user ? @user['name'] : nil, :placeholder => 'First and Last Name', :class => 'form_input' %>
            </fieldset>

            <%= field_set_tag(nil, {:class => (@nickname_error) ? "form_fieldset form_fieldset--error" : "form_fieldset"}) do %>
              <%= label_tag 'nickname', 'Username', :class => 'form_label' %>
              <% if @nickname_error && @nickname_error.include?('has already been taken') %>
                <span class="form_error js-form-error">Sorry, that username is already taken</span>
              <% else %>
                <span class="form_error js-form-error">Please enter a username</span>
              <% end %>
              <%= text_field_tag 'nickname', @user ? @user['nickname'] : nil, :class => 'form_input' %>
            <% end %>

            <%= field_set_tag(nil, {:class => (@email_error) ? "form_fieldset form_fieldset--error" : "form_fieldset"}) do %>
              <%= label_tag 'primary_email', 'Email Address', :class => 'form_label' %>
              <% if @email_error && @email_error.include?('has already been taken') %>
                <span class="form_error js-form-error">Sorry, that email address is already taken</span>
              <% elsif @email_error && @email_error.include?('is invalid') %>
                <span class="form_error js-form-error">Please enter a valid email address</span>
              <% else %>
                <span class="form_error js-form-error">Please enter a valid email address</span>
              <% end %>
              <%= email_field_tag 'primary_email', @user ? @user['primary_email'] : nil, :placeholder => 'email@address.com', :class => 'form_input' %>
            <% end %>

            <fieldset class="form_fieldset">
              <%= label_tag 'password', 'Password', :class => 'form_label' %>
              <span class="form_error js-form-error">Password must be at least five characters</span>
              <%= password_field_tag 'password', @user && @user['password'] ? @user['password'] : nil, :placeholder => '*****', :class => 'form_input' %>
              <span class="form__description">We never spam.</span>
            </fieldset>

            <fieldset class="form_fieldset">
              <%= submit_tag("Create Account", :class => 'button_primer button_command button_command--flexible button_green js-track-event','data-ga_category' => 'Onboarding', 'data-ga_action' => 'Click Start Watching on Step 3' ) %>
            </fieldset>
          </div><!-- eo media_body -->
        </div><!-- eo media_module -->
      </fieldset>

    <% end %>

  </div>
</div>





