(function($){
  
  /* HACK
   * The native Array.prototype.push accepts variable arguments.
   * But on avc.com there is a script (http://avc.fm/js/widget.js) that is overriding [].push
   * Correctly implementing [].push here, restoring the fucked up version at the end of this scope.
   */
  var origPush = Array.prototype.push;
  Array.prototype.push = function(varargs){
    for(var i = 0; i < arguments.length; i++) {
      this[this.length] = arguments[i];
    }
    return this.length;
  };
  
  var embedEl = $("[<%= @embed_attr_key %>=<%= @embed_attr_val %>]");
  
  //embed an iFrame
  var $embedFooterIframe = $(SHELBYJST['turbo/iframe']({width:embedEl.width(), height:40}));
  embedEl.after($embedFooterIframe);

  //content for the iframe
  var embedFooter = SHELBYJST['turbo/embed_footer']({stylesheetLink: '<%= stylesheet_link_tag "screen", :media => "screen" %>',
                                                     embedEl: embedEl, 
                                                     embedElWidth: embedEl.width(),
                                                     userNickname: "<%= @user['nickname'] %>",
                                                     rollLinkURL: "http://<%= @roll['subdomain'] ? @roll['subdomain'] : @user['nickname'] %>.shelby.tv",
                                                     rollLinkText: "<%= @roll['subdomain'] ? @roll['subdomain'] : @user['nickname'] %>.shelby.tv",
                                                     gaQueryParams: "utm_medium=embed&utm_campaign=embellish-footer&utm_source=<%= @user['nickname'] %>"
                                                     });

  //render content in iframe
  $embedFooterIframe[0].contentWindow.contents = embedFooter;
  $embedFooterIframe[0].src = 'javascript:window["contents"]';
  
  //HACK - restore fucked up push (see discussion above)
  Array.prototype.push = origPush;
})(__shelbyTurbo.$);
