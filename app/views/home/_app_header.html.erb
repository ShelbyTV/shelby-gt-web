<% if Rails.env == "staging" %>
  <span class="shelby-title-staging"><%= Settings::Branch.branch %></span>
<% end %>

<span class="shelby-logo visuallydisabled js-home js-track-event" data-ga_category="<%= ga_category %>" data-ga_action="Logo">
  <h1 class="shelby_logo">
    <span class="icon-mark"></span><span class="icon-type"></span><span class="ir">Shelby.tv</span>
  </h1>
</span>

<%
  avatar = avatar_url_for_user(signed_in_user)
%>
<nav id="js-guide-presentation-selector" class="guide-presentation-selector">
  <ul class="js-content-selector list list--inline app_nav clearfix">
    <% if user_signed_in %>
      <li class="list__item">
        <a href="<%= Settings::Mobile.mobile_subdirectory %>/stream" class="app_nav__button<%= " active-item" if pathname == 'stream'%> js-stream js-track-event" data-ga_category="<%= ga_category %>" data-ga_action="Stream" data-ga_label="<%= signed_in_user['nickname'] %>">
          Stream
        </a>
      </li>

      <li class="list__item js-featured-menu">
        <a href="<%= Settings::Mobile.mobile_subdirectory %>/featured" class="app_nav__button<%= " active-item" if pathname == 'featured'%> js-featured js-track-event" data-ga_category="<%= ga_category %>" data-ga_action="Featured" data-ga_label="<%= signed_in_user['nickname'] %>">
          Featured
        </a>
      </li>

      <li class="list__item js-guide-me js-track-event" data-ga_category="<%= ga_category %>" data-ga_action="Me" data-ga_label="<%= signed_in_user['nickname'] %>">
        <a href="<%= Settings::Mobile.mobile_subdirectory %>/<%= signed_in_user['nickname'] %>" class="app_nav__button<%= " active-item" if pathname == 'me' or pathname == 'likes' or pathname == 'shares' %> js-me">
          Me
        </a>
      </li>

      <li class="dropdown_module list__item secondary-item guide-login">
        <button class="dropdown_button app_nav__button app_nav__button--settings<%= (is_mobile) ? ' js-settings-dropdown-button' : ' js-do-nothing' %>" data-ga_category="<%= ga_category %>" data-ga_action="Settings" data-ga_label="<%= signed_in_user['nickname'] %>" type="button">
          <span style="background-image: url('<%= avatar %>');" class="image_module avatar avatar--inline avatar--tiny" role="img"><img src="<%= avatar %>" class="visuallyhidden"/></span>
            <span class="button_label"><%= signed_in_user['nickname']%></span>
            <span class="icon-carrot"></span>
        </button>
        <% if !is_mobile %>
          <section class="dropdown_section settings-section">
            <div class="dropdown_lining fin fin--top_right fin--edging clearfix">

              <%= render :partial => 'objects/user_subnav',
                  :locals => {
                    :is_mobile    => is_mobile,
                    :userNickname => signed_in_user['nickname']
                  } %>

            </div>
          </section>
        <% end %>
      </li><!-- eo login button/dropdown -->
    <% else %>
      <li class="dropdown_module list__item secondary-item guide-login">
        <button class="dropdown_button app_nav__button<%= (user_signed_in) ? ' js-do-nothing' : ' js-login-dropdown-button' %>">
          Log In <span class="icon-carrot"></span>
        </button>

        <% if !is_mobile %>
          <div class="dropdown_section login-section">
            <div class="dropdown_lining fin fin--top_right fin--edging clearfix">

                <%= render :partial => 'objects/login_form' %>

            </div>
          </div>
        <% end %>
      </li><!-- eo login button/dropdown -->
    <% end %>

  </ul><!-- eo guide-presentation-list -->


  <% if is_mobile %>
    <div class="settings-section settings-section--mobile hidden clearfix js-settings-dropdown">
      <%= render :partial => 'objects/user_subnav',
          :locals => {
            :is_mobile    => is_mobile,
            :userNickname => signed_in_user['nickname']
          } %>
    </div>
  <% end %>

  <% if !user_signed_in %>
    <div class="login_panel hidden clearfix js-login-dropdown">
      <%= render :partial => 'objects/login_form' %>
    </div>
  <% end %>
</nav>
