//dependencies
//= require jquery
//= require ./backbone/underscore.js
//= require ./backbone/backbone.js

//plugins
//= require ./jquery-plugins/jquery.urlparams.js

//utils
//= require ./app/browser.js

//for sharing.
//= require ../templates/share-page-form.jst.ejs
//= require ../templates/liker-item.jst.ejs

//load event tracking js
//= require ./event-tracking/mobile.tracking.js


//COMPONENTS
//= require ./components/global.js
//= require ./components/user.js
//= require ./components/video.js
//= require ./components/frame.js
//= require ./components/dashboard_entry.js
//= require ./components/frame_interactions.js
//= require ./components/guide.js
//= require ./components/nav.js
//= require ./components/roll_header.js
//= require ./components/button.js


$(function(){
  Shelby.MobileNav = new Shelby.Navbar({
    el: $('.js-content-selector')
  });

  //init roll header OR sources lists if either of them exists
    var $userCard = $('.js-sources-list, .js-roll-header');

    if($userCard.length) {
      Shelby.UserCard = new Shelby.RollheaderView({
        el: $userCard
      });
    }
  //eo roll header

  Shelby.Guide = new Shelby.MobileGuideView({
    el: $('.js-guide')
  });

  $('body').on('click', 'a:not(.js-play-video,.js-load-more)', function(e) {
    var self = this;
    // click on any link, replace the logo with a spinner so the user can tell something is happening
    e.preventDefault();
    $('#js-header').find('.icon-mark').addClass('icon-mark--spinner');
    window.setTimeout(function() {
      window.location = $(self).attr('href');
    }, 100);
  });

  var loc      = shelbyTrackingCategory || "Mobile",
      username = shelbyTrackingLabel || "Anonymous";

  shelby.trackEx({
    providers: ['ga'],
    gaCategory: loc,
    gaAction: 'Visit page',
    gaLabel: username
  });

  $(this).on('frameLoaded', function(e) {
    var $el = $('#' + e.frame_id);
    var likers = JSON.parse($el.find('.js-likes-array').html());

    if (likers.length) {
      console.log('liekrS!!!',likers,e);
      // injectLikers(likers, $el);
    }
  });

});

$(document).ready(function() {

  var $userLike = $('#js-user-like').html();

  var appendAvatar = function(frame_id) {
    var $frame = $('#' + frame_id);
    $likes = $frame.find('.js-frame-likes');

    // if the logged in user is already in the list, don't add that user again
    if (_(JSON.parse($frame.find('.js-likes-array').html())).indexOf(user.id) != -1) {
      return;
    }

    // append the user to the list:
    $likes.children('.js-liker-avatars-list').append($userLike);
  };

});
