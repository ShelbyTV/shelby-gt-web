<%
  var authed_providers = [];
  if (shelby.models.user.get('authentications') != null){
    shelby.models.user.get('authentications').forEach(function(auth){
      authed_providers.push(auth.provider);
    });
  }
%>

<div class="onboarding_layout_head onboarding-head clearfix">
  <h1 class="onboarding-header">
    Add some serendipity
  </h1>

  <div class="onboarding-next-step-wrapper">
    <button class="js-onboarding-next-step button_primer button_blue button_standard onboarding-next-step">
      Next
    </button>
    <span class="onboarding-next-step-counter">
      Step 3 of 3
    </span>
  </div>
</div><!-- eo onboarding_layout_head -->

<div class="onboarding_layout_body onboarding-body onboarding-stage-3 clearfix">
  <div class="onboarding-block-container wide">
    <p class="onboarding-description">
      Fact: The best discovery happens through distant connections.<br />
      We don't post without your permission, and we won't spam you.
    </p>
  </div>

  <ul class="clearfix onboarding-network-list">
    <% ['twitter', 'facebook', 'tumblr'].forEach(function(network){ %>
      <%
        var connected_network, disabled = '';
        if( _.include(authed_providers, network) ){
          connected_network = 'onboarding-connected-network ';
          disabled = ' disabled ';
        }
      %>

      <li class="onboarding-network-item js-onboarding-network-item">
        <div class="onboarding-network-item-lining clearfix">
          <a class="button_primer<%= (disabled) ? ' button_gray-light disabled' : ' button_'+network+'-blue' %> onboarding-network-button js-authorize js-track-event"
            data-popup_width="1000"
            data-popup_height="650"
            href="http://api.shelby.tv/auth/<%= network %>"
            data-ga_action="Connect with <%= network %>">
            <i class="icon-social_<%= network %>"></i>
            <span class="visuallyhidden"><%= network %></span>
          </a>
          <p class="onboarding-network-description">
            <% if (connected_network) { %>
              We're already pulling in all the<br/>
              videos the people you follow are<br/>
              sharing on <span><%= network %></span>
            <% } else { %>
              Shelby will pull the videos off your<br> <span><%= network %></span> feed.
            <% } %>
          </p>
          <% if (network == 'twitter' && disabled){ %>
            <div class="twitter-follow-shelby onboarding-network-additional-options clearfix">
              <input id="onboarding-follow-shelby" class="form_checkbox connected-network-checkbox js-onboarding-follow-shelby" name="onboarding-follow-shelby" type="checkbox" checked >
              <label for="onboarding-follow-shelby" class="form_label">
                Follow @Shelby on Twitter
              </label>
            </div>
          <% } %>
          <% if (network == 'facebook' && disabled){ %>
            <div class="facebook-timeline-opt-in onboarding-network-additional-options clearfix">
              <input id="onboarding-timeline-sharing" class="form_checkbox connected-network-checkbox" name="preferences-timeline-sharing" type="checkbox" checked >
              <label for="preferences-timeline-sharing" class="form_label">
                Facebook Timeline Sharing
              </label>
              <p class="timeline-sharing-description">
                I want to share <b><%= shelby.models.user.get('nickname') %>.shelby.tv</b> and videos I watch on Shelby with my friends on my Facebook Timeline
              </p>
            </div>
          <% } %>
        </div>
      </li>
    <% }); %>
  </ul>
</div><!-- eo onboarding_layout_body -->
