<%
  var messageJSON;
  if (message) {
    messageJSON = message.toJSON();
    messageJSON.text = message.escape('text');
  } else {
    /*
      if there is no message, create something that looks like
      a message so that the frame displays who created it and when
    */
    var creator = frame.get('creator');
    messageJSON = {
      created_at : frame.get('created_at'),
      nickname : (creator ? creator.get('nickname') : ""),
      user_id : (creator? creator.id : ""),
      user_image_url : libs.shelbyGT.viewHelpers.user.avatarUrl(creator)
    };
  }
%>
<blockquote class="media_module">
  <a href="#" onclick="return false;" class="media_image js-user-personal-roll">
    <span class="image_module xuser-avatar" style="background-image: url(<%= libs.shelbyGT.viewHelpers.user.avatarUrlForMessage(message) %>);" role="img">
      <img src="<%= libs.shelbyGT.viewHelpers.user.avatarUrlForMessage(message) %>" class="visuallyhidden" title="<%= messageJSON.nickname %>" alt="<%= messageJSON.nickname %>">
    </span>
  </a>
  <div class="media_body">
    <p class="xuser-data">
      <a href="#" onclick="return false;" class="xuser-data-link js-user-personal-roll js-track-event" data-ga_category="Message" data-ga_action="Click user roll link" data-ga_label='<%= user.get('nickname') %>' data-user-id="<%= messageJSON.user_id %>">
        <span class="xuser-data-timestamp">
          <%= messageJSON.created_at %>
        </span>
        <strong>
          <%= messageJSON.nickname %>
        </strong>
      </a>
    </p>
    <p>
      <%= messageJSON.text %>
    </p>
    <div class="xframe-subline">
      <a class="xframe-link conversation-message-reply js-message-reply js-track-event" href="#" data-ga_category="Message" data-ga_action="Click reply" data-ga_label="<%= user.get('nickname') %>" data-reply_to="<%= messageJSON.nickname %>">Reply</span>
    </div>
  </div>
</blockquote><!-- eo .media_module-->