<html>
<body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<style>
.form {
	margin: 0em 0em 2em 0em;
	position:relative;
	font-family: Helvetica, Geneva, sans-serif;
	font-size: 16px;
	line-height: 18px;
	text-decoration: none;
	-webkit-border-radius: 10px;
	-moz-border-radius: 10px;
	border-radius: 10px;
	padding:10px;
	display: inline-block;
	border: 1px solid #999;
	border: inset 1px solid #333;
	-webkit-box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
	-moz-box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
	box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
}
.centerMe {
	text-align: center;
}
.name {
	text-align: center;
	display: inline;
}
input {
	width: 375px;
	display: block;
	border: 1px solid #999;
	height: 25px;
}
.submit {
	background-color: orange;
	font-size: 18px;
	height: 30px;
	border: 3px solid black;
	margin: 2px 2px 2px 2px;
	width: 94px;
	margin-right: auto;
	margin-left: auto;
}
.username {
	font-size: .8em;
}

</style>
<script type="text/javascript">
window.fbAsyncInit = function() {
	FB.init({
	  appId      : 115071338568035, // App ID
	  channelURL : 'http://shelby.tv/channel.html', // Channel File
	  status     : true, // check login status
	  cookie     : true, // enable cookies to allow the server to access the session
	  oauth      : true, // enable OAuth 2.0
	  xfbml      : true  // parse XFBML
	});
  };
  // Load the SDK asynchronously
  (function(d, s, id){
	 var js, fjs = d.getElementsByTagName(s)[0];
	 if (d.getElementById(id)) {return;}
	 js = d.createElement(s); js.id = id;
	 js.src = "//connect.facebook.net/en_US/all.js";
	 fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
function orderId(data) {
	var values=[];
	var temp=[]; 
	var keys=[];
	var answer=[];
	for (var key in data) {
		values.push(data[key]);
		temp.push(data[key]);
		keys.push(key);
	}
	temp.sort(function(a,b){return b-a});
	for (var x in temp) {
		if (answer.indexOf(keys[values.indexOf(temp[x])])!=-1) {
			delete values[values.indexOf(temp[x])];
		}
		answer.push(keys[values.indexOf(temp[x])]);
	}
	return answer;
}
function displayFriends (friends, id) {
	$('.'+id+'1').remove();
	for (var x=0; x < Math.min(friends.length,20); x++) {
		$("."+id).append('<li class="'+id+'1 post">'+'<img src="https://graph.facebook.com/'+friends[x]+'/picture"><span class="'+friends[x]+'" username"></span></li>');
		FB.api('/'+friends[x]+'?fields=name','get',function(response){
			$("."+response.id).text(response.name);
		});			
	}
}
function process (data) {	
	for (var i in data.fql_result_set){	
		if (val[data.name]==undefined) break;
			var id = data.fql_result_set[i][val[data.name].data];
			if (id in ids) ids[id]+=val[data.name].val;
			else ids[id]=val[data.name].val;
	}
	displayFriends(orderId(ids),'go');
}
function process2() {
	window.statusData=[1331550225,100000030999600,100000152883013,519035738,586121302,854315174,647845190,854315174,647845190,1043554591,100000152883013,100000030999600,854315174,647845190,854315174,647845190,1598161380,647845190,1687980018,1344001825];
	window.messageData=[1306417426,514233521,100000152883013,514233521,1687980018,514233521,514233521,1331550225,1663209170,514233521,716941386,1089990563,774384166,514233521,1258335120,1821308617,514233521,514233521,514233521,1391981422,514233521,854315174,1043554591,514233521,1444629544,100000152883013,603212209,514811764,672329108,625864457,1201314384,585286033,1043554591,100002192177788,514233521,100000030999600,519641619,514233521,1089990563,514233521,909245104,836740116,514233521,514233521,100000030806917,514233521,1360772286,514233521,1427707480,514233521,759176903,514233521,774384166,514233521,673723929,1079456261,514233521,514233521,630370476,514233521,1178422919,1448198986,514233521,514233521,1200829295,514233521,1002144438,514233521,547851341,514233521,750571542,514233521,631217385,514233521,1382520516,685869243,514233521,1306417426,514233521,100000030806917,100000226943764,514233521,703405919,514233521,1380240482,100001215002973,514233521,519035738,514233521,514233521,100000352772924,1663209170,514233521,514233521,556097074,514233521,683947409,504092771,514233521,586121302,514233521,1598161380,514233521,514233521,514811764,514233521,100003699774021,514233521,614980229,514233521,100000030999600,514233521,662712660,1530338,514233521];
	window.photoData=[100000657033349,514233521,1448198986,514233521,614980229,572131664,586121302,100003338205589,749730236,677940382,779847929,1337173977,1231164609,514233521,1077584642,514233521,1448198986,514233521,514233521,1043554591,519035738,514233521,1043554591,519035738,514233521,1043554591,519035738,514233521,1043554591,519035738,514233521,725382936,1185439645,100001545467867,603182676,1448198986,1258335120,526887276,1305674084,1687980018,538921123,1178422919,514233521,100000226943764,514233521,514233521,1247154572,514233521];
	ids2=ids;
	for (var x in statusData) {		
		if (statusData[x] in ids2) ids2[statusData[x]]+=80;
		else ids2[statusData[x]]=80;
	}
	for (var x in messageData) {
		if (messageData[x] in ids2) ids2[messageData[x]]+=100;
		else ids2[messageData[x]]=100;
	}
	for (var x in photoData) {
		if (photoData[x] in ids2) ids2[photoData[x]]+=40;
		else ids2[photoData[x]]=40;
	}
	displayFriends(orderId(ids2),'more');
}
$(document).ready(function(){
	console.log("ready");
	$('.submit').click(function(d){		
		FB.getLoginStatus(function(response) {
			if (response.status === 'connected') {
				console.log("started");
				window.val={'link':{val:parseInt($('input[name="link"]').val()), data:"owner"}, 'post':{val:parseInt($('input[name="post"]').val()), data:"actor_id"}, 'status':{val:parseInt($('input[name="status"]').val()),data:"uid"}, 'mutual':parseInt($('input[name="mutual"]').val()), 'newsFeed':{val:parseInt($('input[name="newsFeed"]').val()),data:"actor_id"}};
				var friends=0;
				window.ids ={};
				window.ids2 ={};
				// FB.api('/me/friends?fields=installed', 'get', function(response) {          
				// 	for (var x in response.data) {              
				// 		if (response.data[x].installed==true) {
				// 			$('.go').append('<div class="post" style="display:inline;">'+'<img src="https://graph.facebook.com/'+response.data[x].id+'/picture"></div>');
				// 		}
				// }});
				// FB.api('514233521?fields=tagged','get',function(response){
				// //console.log(response);
				// });
				FB.api('/me?fields=friends','get',function(response){
					friends=response.friends.data.length;
				});	
				FB.api({
					method: 'fql.multiquery',
					queries: { //use # to merge queries later 			
						'friends': 'select uid1 from friend where uid2=me()',
						'objects': 'select object_id from like where user_id=me() limit 300',
						'post':'select actor_id from stream where source_id=me() and actor_id in (select uid1 from #friends) limit 100',
						'status':'select uid from status where status_id in (select object_id from #objects)',
						'link':'select owner from link where link_id in (select object_id from #objects)',
						// 'friends in photo':'select subject from photo_tag where pid in (select pid from photo_tag where subject=me())',
						// 'friends in messages':'select recipients from thread where folder_id=1',
						// 'postTo':'select target_id from connection where source_id=me() and target_type="user"',
						'newsFeed':'SELECT actor_id FROM stream WHERE filter_key in (SELECT filter_key FROM stream_filter WHERE uid=me() and type = "newsfeed") and actor_id in (select uid1 from #friends) limit 50'
						// 'postTo':'select target_id from stream_tag where post_id in (select status_id from status where uid=me())' can't get need more permissions status 

					}
				}, function(response){
					var randoFriend=[]; 
					for (var x in response){
						if (val[response[x].name]!=undefined) process(response[x]);
						if (response[x].name=='friends') {
							while (randoFriend.length<21){
								var random = Math.floor(Math.random()*response[x].fql_result_set.length);
								if (randoFriend.indexOf(x)==-1) randoFriend.push(random);
							}
							for (var y in randoFriend){
								
								randoFriend[y]=parseInt(response[x].fql_result_set[randoFriend[y]].uid1);
								//console.log(randoFriend[x]);
							}
							displayFriends(randoFriend,'friends');
						}
					}					
					process2();
					$('.post').click(function(d){
						var u=d.toElement.src;
						u=u.slice(u.indexOf('.com/')+5,u.indexOf('/picture'));
						FB.api('/'+u+'?fields=name','get',function(response){console.log(response.name);});
					});		
				});
				
				// FB.api('/me?fields=feed.limit(20)', 'get', function(response){					
				// 	response.feed.data.forEach(function(story){				
				// 		if (story.likes != undefined){
				// 			story.likes.data.forEach(function(like){
				// 				if (!(like.id in ids)) ids[like.id]=likeVal;
				// 				else ids[like.id]+=likeVal;
				// 			})
				// 		}
				// 		if (story.comments != undefined){
				// 			story.comments.data.forEach(function(comment){
				// 				if (!(comment.from.id in ids)) ids[comment.from.id]=commentVal;
				// 				else ids[comment.from.id]+=commentVal;
				// 			})
				// 		}
				// 		if (!(story.from.id in ids)) ids[story.from.id]=storyVal;
				// 		else ids[story.from.id]+=storyVal;
				// 	});
				// 	window.idCount=0;
				// 	for (var j in ids) idCount++;
				// 	var i=0;
				// 	for (var key in ids) {							
				// 		FB.api('/me?fields=friends.uid('+key+').fields(mutualfriends)','get',function(response){	
				// 			if (response.friends!=undefined) {	
				// 				ids[response.friends.data[0].id]*=(1+mutualVal+response.friends.data[0].mutualfriends.data.length/friends);
				// 			}
				// 			i++;
				// 			if (i==idCount) displayFriends(orderId(ids));
				// 		});

				// 	}					
				// });   				
			}			
		});
	return false;
	});
});
	// var link= "https://graph.facebook.com/me/friends";        
	// $(document).ready(function(){
	//   $.getJSON(link, function(data){
	//     console.log(data.data);  
	//   });
	  // var url = 'https://graph.facebook.com/search?type=post&q='+ $('#q').val();
	  // $.getJSON(url, function(data) {
	  //       obj = data.data;
	  //       Object.keys(obj).forEach(function(key){
	  //           $('.go').append('<div class="post">'+'<img src="https://graph.facebook.com/'+obj[key].from.id+'/picture">'+obj[key].message+'</div>');
	  //       });
	  // });
	//});
</script>
<div id="fb-root"></div>
<div id="centerMe">
	<form class="form">
		<div class="container">
			<div class="name">Value for link: (1...100)</div><input type="text" name="link" value="50"><br>
			<div class="name">Value for story on your wall: (1...100)</div><input type="text" name="post" value="30"><br>
			<div class="name">Value for liked status: (1...100)</div><input type="text" name="status" value="60"><br>
			<div class="name">Value for newsfeed post: (1...100)</div><input type="text" name="newsFeed" value="20"><br>
			<div class="name">Value for mutual friends (1...10):</div><input type="text" name="mutual" value="7"><br>
			<input type="submit" value="Test" class='submit'>
		</div>
	</form>
</div>
<table border="0" cellpadding="5" cellspacing="0" width="660">
<div>
	<div style="float: left; width: 25%;">1st List
		<ol class="friends"></ol>
	</div>
	<div style="float: left; width: 25%;">2nd List
		<ol class="go"></ol>
	</div>
	<div style="float: left; width: 25%;">3rd List
		<ol class="more"></ol>
	</div>
</div>
</table>
</body>
</html>